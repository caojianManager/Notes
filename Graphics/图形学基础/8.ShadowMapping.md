# ShadowMapping

ShadowMapping 是光栅化渲染中最常用的一种生成阴影的方式

## ShadowMapping

ShadowMapping 本质上是一种图像空间上的做法。
也就是在生成阴影的这一步，是不需要知道场景的空间信息的。
![alt text](../images/shadow_mapping/sm_1.gif)

### ShadowMapping的主要思想

ShadowMapping 的主要思想其实很直观：

**如果一个点不在阴影里，而我们又能看到这个点，那就说明这个点能被相机看到，并且也能被光源看到。**

**而如果一个点在阴影里，而我们又能看到这个点，那就说明这个点能被相机看到，并且不能被光源看到。**
![alt text](../images/shadow_mapping/sm_2.jpg)

### ShadowMapping的实现思路.

既然前面说我们判断一个点在不在阴影里，是需要判断光源能不能看见，那么我们就需要想办法看一眼。

因此，我们可以先在**光源处放置一个虚拟的相机看向场景，然后做一遍深度测试，得到一张深度图**，通过深度图就能知道光源看到了什么。

然后**再从相机位置看向场景，并将看到的每一个像素点，都投影回光源相机看到的画面中，计算这个像素在光源相机下的深度值**。

用这个**深度值和光源相机渲染得到的深度图上对应的深度进行比较。如果大于深度图上记录的深度，那么说明这个像素点会被遮挡。**
![alt text](../images/shadow_mapping/sm_3.jpg)

### ShadowMapping 的具体实现

使用了ShadowMapping和未使用ShadowMapping的对比

![alt text](../images/shadow_mapping/sm_4.jpg)

#### 第一趟pass,生成阴影贴图

将相机放在光源位置，用 z-buffer 的方式存一张深度图，称之为阴影贴图 (Shadow Map)，并记录此时的投影变换矩阵 M，点光源对应透视投影，定向光对应正交投影

![alt text](../images/shadow_mapping/sm_5.jpg)