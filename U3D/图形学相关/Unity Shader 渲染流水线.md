
## 一.什么是渲染流水线？

显卡内部处理图像信息的并行处理单元，即渲染流水线。发生位置在CPU和GPU.

## 二.渲染机理？

将图像所具备的图形信息(顶点、纹理、材质、摄像机位置等)经过一系列阶段的处理,最终- 转换为屏幕上的图像.

## 三.渲染流水线

![[U3D/图形学相关/-images/img_0.png]]

### 应用阶段(CPU)

+ 阶段性目标：准备渲染所需要的几何信息，即渲染图元。
+ 渲染数据:
	 + 场景数据：如摄像机位置，模型，光源，视锥体
	 + 粗粒度剔出：即提出不可见物体
	 + 设置渲染状态： 材质，纹理，Shader等
+ 基本流程:
	+ 加载数据到显存：渲染数据先从硬盘加载到RAM,再加载到显存以供GPU后续处理。
	+ 设置渲染状态: 定义渲染图形的方式,例如使用顶点着色器或者片元着色器、材质、光源等.
	+ 调用Draw Call:由CPU发起的Draw Call指令给GPU，指向已经准备好的渲染图元。
+ 什么是Draw Call?
	+ 本质：图像编程接口;
	+ 机理：CPU通过调用Draw Call向命令缓冲区(Command Buffer)的队列中添加渲染命令，而GPU则从已经有队列中读取渲染命令执行。
	+ 优化：由于调用Draw Call即使得CPU准备大量渲染数据提交到缓冲队列，大量的Draw Call会使得CPU过载，因此尽量减少Draw Call调用次数(如进行批处理，合并网格..)
### 几何阶段(GPU)

+ 接受数据:应用阶段所准备好的渲染图元的信息，就是(模型自身坐标，顶点颜色，纹理坐标UV等)。
+ 阶段目标:决定所需要绘制的图元信息(绘制方法，绘制坐标)
+ 基本流程:
	+ 顶点着色器(Vertex Shader)：每个顶点均调用一次,职责是坐标转换(模型空间->齐次裁剪空间，也可说模型自身坐标->屏幕空间坐标。可人为干涉)和逐顶点光照(颜色计算)
	+ 曲面细分着色器(Tessellation Shader)：细分图元
	+ 几何着色器(Geometry Shader):逐图元着色操作或是生成新的图元(减少CPU负担)
	+ 裁剪(Clipping):裁剪去不在摄像机视野内的顶点
	+ 屏幕映射(Screen Mapping):将图元的x和y坐标转换到屏幕坐标系(不对z坐标处理)

### 光栅化阶段(GPU)

