## 一.进程和线程

**进程：**
一个在内存中运行的应用程序。每个进程都有自己独立的一块内存空间，一个进程可以有多个线程。eg:windows系统中，一个.exe就是一个进程。

进程是操作系统资源分配的基本单位。

**线程：**
进程中的一个执行任务(控制单元)，负责进程中程序的执行。
一个进程可以有1个或多个线程，多线程可共享数据。

线程是任务调度和执行的基本单位。

## 二.线程，进程，协助区别

+ 进程拥有自己独立的堆/栈，即不共享堆，也不共享栈，进程有操作系统调度。
+ 线程拥有自己独立的栈和共享的堆，共享堆，不共享栈，线程亦由操作系统调度（标准线程是的）。
+ 协程和线程一样共享堆，不共享栈，协程由程序员的代码显示调度。

## 三.Unity协程执行原理

### 协程的由来

Unity只使用了一个线程，但我们需要“同时做很多事情”，那Unity作为单线程，该如何去做，协程就来了，协程是一种“伪线程”。

协同程序(Coroutine),即协作式程序，一系列互相依赖的协程依次使用CPU,每次只有一个协程工作，而其他协程处于休眠状态。

协程实际上是一个在线程中，只不过每个协程对CPU进行分时，协程可以访问使用unity的所有方法和Component;

同一时间只能执行某个协程，协程适合对某个任务进行分时处理。

协程不是线程，也不是异步执行，跟Update一样，在主线程中执行。(不用考虑同步和锁的问题)

协程是一个分部组件，遇到条件(yield return)会挂起，直到条件满足才会被唤起执行后面的语句。

### 执行原理

![[img_0.png]]

unity中协程执行过程中，通过yield return XXX，将程序挂起，去执行接下来的内容，注意协程不是线程，在为遇到yield return XXX语句之前，协程的方法和一般的方法是相同的，也就是程序在执行到yield return XXX语句之后，接着才会执行的是StartCoroutine()方法之后的程序，走的还是单线程模式，仅仅是将yield return XXX语句之后的内容暂时挂起，等到特定的时间才执行。

那么挂起的程序什么时候才执行，这就要看monoBehavior的生命周期了。

![[img_1.png]]

也就是协同程序主要是Update()方法之后，LateUpdate()之前调用的，如下示例：

```c#
using UnityEngine;
using System.Collections;
using System.Threading;
public class test : MonoBehaviour
{
 
    void Start()
    {
        StartCoroutine(tt());//开启协程
        for (int i = 0; i < 200; i++)   //循环A
        {
            Debug.Log("*************************" + i);
            Thread.Sleep(10);
        }
    }
 
    IEnumerator tt()
    {
        for (int i = 0; i < 100; i++) //循环B
        {
            Debug.Log("-------------------" + i);
        }
        yield return new WaitForSeconds(1); //协程1
        for (int i = 0; i < 100; i++) //循环C
        {
            Debug.Log(">>>>>>>>>>>>>>>>>>>>" + i);
            yield return null; //协程1
        }
    }
    // 更新数据
    void Update()
    {
        Debug.Log("Update");
    }
    //晚于更新
    void LateUpdate()
    {
        Debug.Log("------LateUpdate");
    }
}
```

程序运行结果
![[img_2.png]]

先执行循环B，然后执行循环A，然后执行Update()和LateUpdate()的方法，等待1s之后，在Update()和LateUpdate()之间执行循环C的输出。

### 线程和进程的区别

+ 地址空间：线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间。
+ 资源拥有：进程是资源分配和拥有的单位，同一个进程内的线程共享进程的资源。
+ 线程是处理器调度的基本单位，但进程不是
+ 二者均可并发执行
+ 每个独立的线程有一个程序运行的入口，顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。